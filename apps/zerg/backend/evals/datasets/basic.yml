version: "1.0"
description: Basic supervisor eval - hermetic mode (7 test cases)

# Phase 1: These cases run in hermetic mode with stubbed LLM responses
# The stub LLM returns deterministic outputs, so assertions are predictable

cases:
  # 1. Conversational - Simple greeting
  - id: greeting_simple
    category: conversational
    description: Basic greeting should respond without spawning worker
    input: "Hello, how are you?"
    timeout: 30
    assert:
      - type: contains
        value: "stub-response"
        case_insensitive: true
      - type: worker_spawned
        count: 0
      - type: latency_ms
        max: 10000
      - type: status
        value: success
    tags: [quick, conversational]

  # 2. Supervisor tool usage - list workers
  - id: list_workers
    category: tool_usage
    description: Supervisor should call list_workers tool (hermetic mode)
    input: "List recent worker jobs"
    timeout: 30
    assert:
      - type: status
        value: success
      - type: tool_called
        value: "list_workers"
      - type: worker_spawned
        count: 0
      - type: latency_ms
        max: 10000
    tags: [quick, tool_usage]

  # 3. Supervisor tool usage - spawn worker
  - id: spawn_worker
    category: infrastructure
    description: Supervisor should delegate via spawn_worker (hermetic mode)
    input: "Delegate checking disk space on cube"
    timeout: 60
    assert:
      - type: status
        value: success
      - type: tool_called
        value: "spawn_worker"
      - type: worker_spawned
        min: 1
      - type: latency_ms
        max: 15000
    tags: [infrastructure]

  # 4. Infrastructure - Memory check
  - id: check_memory
    category: infrastructure
    description: Infrastructure request for memory check (hermetic mode)
    input: "Check memory usage on cube"
    timeout: 60
    assert:
      - type: status
        value: success
      - type: latency_ms
        max: 15000
    tags: [infrastructure]

  # 5. Infrastructure - Disk check
  # In hermetic mode, stub LLM decides whether to call tools based on keywords
  - id: check_infrastructure
    category: infrastructure
    description: Infrastructure request (hermetic mode - no real worker)
    input: "Check disk space on cube"
    timeout: 60
    assert:
      - type: status
        value: success
      - type: latency_ms
        max: 15000
    tags: [infrastructure]

  # 6. Tool usage - Time check
  - id: get_time
    category: tool_usage
    description: Simple tool call (hermetic mode)
    input: "What time is it?"
    timeout: 30
    assert:
      - type: status
        value: success
      - type: latency_ms
        max: 10000
    tags: [quick, tool_usage]

  # 7. Performance - Token budget check
  - id: token_budget_simple
    category: performance
    description: Simple task should use minimal tokens
    input: "Hi"
    timeout: 30
    assert:
      - type: status
        value: success
      - type: total_tokens
        max: 5000  # Generous for hermetic mode
      - type: latency_ms
        max: 10000
    tags: [quick, performance]
