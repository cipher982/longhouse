# Patrol Finding: edge_case

**Date:** 2026-01-28T12:17:22.644901
**Target:** apps/zerg/backend/zerg/jobs/git_sync.py
**Prompt:** edge_case

## Description

_get_auth_url() produces malformed URLs when given SSH-format repo URLs with a token. SSH URLs (git@github.com:user/repo.git) don't follow standard scheme://netloc/path format, causing urlparse to misparse them. The code then produces an invalid authenticated URL that will fail cryptically during clone.

## Evidence

- `apps/zerg/backend/zerg/jobs/git_sync.py:73-80`

## Test

```python
def test_ssh_url_with_token_mishandled():
    service = GitSyncService(
        repo_url="git@github.com:user/repo.git",
        local_path="/tmp/test",
        token="ghp_test123"
    )
    auth_url = service._get_auth_url()
    # Expected: Either raise error or handle SSH URL properly
    # Actual: Returns malformed URL like 'ghp_test123@@/git@github.com:user/repo.git'
    assert '@@' in auth_url  # Bug: double @ indicates malformed URL
```

## Suggested Fix

Add URL format validation in _get_auth_url() to detect SSH URLs and raise GitSyncError('Cannot use token auth with SSH URLs - use ssh_key_path instead')

---
*Generated by patrol/edge_case*
